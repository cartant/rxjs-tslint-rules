import { combineLatest, of, Subject } from "rxjs";
import { switchMap, takeUntil, shareReplay, tap } from "rxjs/operators";

const a = of("a");
const b = of("b");
const c = of("c");
const d = of("d");

const e = a.pipe(switchMap(_ => b)).subscribe();

const f = a.pipe(switchMap(_ => b), takeUntil(d)).subscribe();

const g = a.pipe(takeUntil(d), s => switchMap(_ => b)).subscribe();

class MyClass {
    someMethod() {
        const e = a.pipe(switchMap(_ => b)).subscribe();

        const f = a.pipe(switchMap(_ => b), takeUntil(d)).subscribe();

        const g = a.pipe(takeUntil(d), s => switchMap(_ => b)).subscribe();
    }
}

@Component({
  selector: 'app-my'
})
class MyComponent {
      ~~~~~~~~~~~                               [enforce-takeuntil-before-subscribe-ondestroy]

    private destroy$: Subject<void> = new Subject<void>();

    k$ = a.pipe(shareReplay(1));
                ~~~~~~~~~~~~~~            [enforce-takeuntil-before-operator-sharereplay]

    someMethod() {
        const d = a.subscribe();
                    ~~~~~~~~~                               [enforce-takeuntil-before-subscribe]

        const e = a.pipe(switchMap(_ => b)).subscribe();
                                            ~~~~~~~~~                               [enforce-takeuntil-before-subscribe]

        const f = a.pipe(switchMap(_ => b), takeUntil(this.destroy$)).subscribe();

        const g = a.pipe(takeUntil(this.destroy$), switchMap(_ => b)).subscribe();
                                                                      ~~~~~~~~~            [enforce-takeuntil-before-subscribe]

        const h = a.pipe(switchMap(_ => b), takeUntil(d)).subscribe();
                                                      ~            [enforce-takeuntil-before-subscribe-subject-name]

        const k1 = a.pipe(takeUntil(this.destroy$), shareReplay(1)).subscribe();
                                                                    ~~~~~~~~~            [enforce-takeuntil-before-subscribe]

        const k = a.pipe(shareReplay(1), takeUntil(this.destroy$)).subscribe();
                         ~~~~~~~~~~~~~~            [enforce-takeuntil-before-operator-sharereplay]

        const m = a.pipe(tap(), shareReplay(1), takeUntil(this.destroy$)).subscribe();
                                ~~~~~~~~~~~~~~            [enforce-takeuntil-before-operator-sharereplay]

        const n = a.pipe(takeUntil(d), shareReplay(1), takeUntil(this.destroy$)).subscribe();
                                   ~            [enforce-takeuntil-before-subscribe-subject-name]

    }
}

@Component({
  selector: 'app-my'
})
class MyComponent implements OnDestroy {
    someMethod() {
        const f = a.pipe(switchMap(_ => b), takeUntil(this._destroy$)).subscribe();
    }

    ngOnDestroy() {
    ~~~~~~~~~~~            [enforce-takeuntil-before-subscribe-next-missing]
    ~~~~~~~~~~~            [enforce-takeuntil-before-subscribe-complete-missing]
      // this._destroy$.next() is missing
      this.destroy$.next();
      this.destroy$.complete();
    }
}

@Component({
  selector: 'app-my'
})
class MyComponent implements SomeInterface, OnDestroy {
    private destroy$: Subject<void> = new Subject<void>();

    k$ = a.pipe(takeUntil(this.destroy$), shareReplay(1));

    someMethod() {
        const e = a.pipe(switchMap(_ => b), takeUntil(this.destroy$)).subscribe();

        const k = a.pipe(takeUntil(this.destroy$), shareReplay(1), takeUntil(this.destroy$)).subscribe();
    }

    ngOnDestroy() {
      this.destroy$.next();
      this.destroy$.complete();
    }
}


[enforce-takeuntil-before-subscribe]: subscribe within a component must be preceded by takeUntil
[enforce-takeuntil-before-subscribe-subject-name]: takeUntil argument must be a property of the class, e.g. takeUntil(this.destroy$)
[enforce-takeuntil-before-subscribe-ondestroy]: component containing subscribe must implement the ngOnDestroy() method
[enforce-takeuntil-before-subscribe-next-missing]: there must be an invocation of this._destroy$.next() in ngOnDestroy()
[enforce-takeuntil-before-subscribe-complete-missing]: there must be an invocation of this._destroy$.complete() in ngOnDestroy()
[enforce-takeuntil-before-operator-sharereplay]: the shareReplay operator used within a component must be preceded by takeUntil
